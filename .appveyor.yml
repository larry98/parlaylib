os: Visual Studio 2019
platform: x64


environment:
  matrix:
    - job_name: Microsoft Visual C++
      compiler: msvc-16-seh
      generator: "Visual Studio 16 2019"
      build_system: cmake
      
    - job_name: MinGW  
      compiler: gcc-8.1.0-posix
      build_system: cmake
      generator: "MinGW Makefiles"
      cxx_path: 'C:\mingw-w64\i686-8.1.0-posix-dwarf-rt_v6-rev0\mingw32\bin'

    - job_name: Cygwin
      CYG_ROOT: C:\cygwin_parlay
      CYG_BASH: C:\cygwin_parlay\bin\bash
      CYG_MIRROR: http://mirrors.kernel.org/sourceware/cygwin/
      CYG_PACKAGES: git,make,gcc-core,gcc-g++,cmake
      

for:
  -
    matrix:
      only:
        - job_name: Microsoft Visual C++
    build_script:
    - ps: |
        md build
        cd build
        cmake -G $env:generator -A x64 -DCMAKE_BUILD_TYPE=Debug -DPARLAY_TEST=On ..
        cmake --build .
        cmake --build . --target check
  
  -
    matrix:
      only:  
        - job_name: MinGW
    build_script:
    - ps: |
        md build
        cd build
        $env:path = $env:path.replace("C:\Program Files\Git\usr\bin;", "")
        $env:path += ";$env:cxx_path"
        cmake -G $env:generator -DCMAKE_BUILD_TYPE=Debug -DPARLAY_TEST=On ..
        cmake --build .
        cmake --build . --target check

  -
    matrix:
      only:          
        - job_name: Cygwin
    install:
    - ps: 'Start-FileDownload "https://cygwin.com/setup-x86_64.exe" -FileName "setup-x86_64.exe"'
    - 'setup-x86_64.exe --quiet-mode --no-shortcuts --only-site --root "%CYG_ROOT%" --site "%CYG_MIRROR%" --local-package-dir "%CYG_ROOT%\var\cache\setup" --packages "%CYG_PACKAGES%"'
    build_script:
    - '%CYG_BASH% -lc "cd $APPVEYOR_BUILD_FOLDER; mkdir build"'
    - '%CYG_BASH% -lc "cd $APPVEYOR_BUILD_FOLDER/build; cmake -DCMAKE_BUILD_TYPE=Debug -DPARLAY_TEST=On .."'
    - '%CYG_BASH% -lc "cd $APPVEYOR_BUILD_FOLDER/build; make"'
    - '%CYG_BASH% -lc "cd $APPVEYOR_BUILD_FOLDER/build; make test"'
